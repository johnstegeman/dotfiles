# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Install z-shell (zi plugin manager)
source <(curl -sL init.zshell.dev); zzinit

####### Utility functions
source_if_exists() { [ -f "$1" ] && source "$1" }

source_directory() {
if [ -d "$1" ]; then
  for file in "$1"/*.zsh; do
     source "$file"
  done
fi
}
######## End of utility functions

# Some configuration variables 

export TERM=xterm-256color
ENABLE_CORRECTION="false"
COMPLETION_WAITING_DOTS="true"

# Add homebrew's bin and local bin directories to the path
#
export PATH=/opt/homebrew/bin:~/bin:~/.local/bin:$PATH

# Run any custom scripts in .zsh_custom
#
source_directory ~/.zsh_custom

# ZSH plugins
#
zi light MichaelAquilina/zsh-you-should-use

DIRCOLORS_SOLARIZED_ZSH_THEME="256dark"
zi light pinelibg/dircolors-solarized-zsh

zi snippet OMZP::copybuffer
zi snippet OMZP::direnv
zi light z-shell/H-S-MW
zi snippet OMZP::colored-man-pages
zi snippet OMZP::history
zi light z-shell/z-a-meta-plugins
zi light zsh-users/zsh-history-substring-search

#install meta-plugins
#
zi light-mode for @annexes \
  @zsh-users+fast \
  @romkatv \
  skip'skim' @fuzzy

zi for as"null" lucid from"gh-r" \
mv'moar* moar' sbin'**/moar(.exe|) -> moar' walles/moar

zi for as"null" lucid from"gh-r" \
mv'dua* dua' sbin'**/dua(.exe|) -> dua' Byron/dua-cli

zi for as"null" lucid from"gh-r" \
mv'duf* duf' sbin'**/duf(.exe|) -> duf' muesli/duf

# Avoid installing exa if it already exists (on Ubuntu, for example)
# to avoid getting an exa binary with the wrong architecture
#
if (( $+commands[exa] )); then
    zi light-mode for skip'tig vivid hexyl exa' @console-tools
else
    zi light-mode for skip'tig vivid hexyl' @console-tools
fi

fast-theme -q default  # This is the theme for fast syntax highlighting

# Needed for omzsh theme support
#
zi snippet OMZL::git.zsh
zi snippet OMZP::git

# only install the zsh-exa plugin once exa is available.
# Otherwise, this will exit the shell!
#
zi ice has'exa'
zi load zplugin/zsh-exa
export exa_params=('--time-style=long-iso' '--group-directories-first')

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

##### The following are the z-shell commands to load the theme

ZSH_THEME="powerlevel10k/powerlevel10k"
zi cdclear -q
setopt prompt_subst

### End of theme code
#

# Initialize zoxide if it's installed
# use the letter "j" instead of "z"
# to avoid conflict with z-shell's "zi" command

if (( $+commands[zoxide] )); then
  eval "$(zoxide init --cmd j zsh)"
  alias cd=j
fi
